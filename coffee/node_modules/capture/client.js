// Generated by CoffeeScript 1.6.2
(function() {
  var childProcess, path, phantomjs;

  childProcess = require('child_process');

  path = require('path');

  phantomjs = require('phantomjs');

  module.exports = (function() {
    function _Class(dna) {
      this.dna = dna;
      this.chunks = [];
      this.length = 0;
    }

    _Class.prototype.run = function(callback) {
      var stream,
        _this = this;

      stream = childProcess.spawn(phantomjs.path, [path.join(__dirname, 'bridge.js')]);
      stream.stdin.write(JSON.stringify(this.dna) + "\n");
      stream.stdout.on('data', function(chunk) {
        _this.chunks.push(chunk);
        return _this.length += chunk.length;
      });
      return stream.on('exit', function(code) {
        var buf, c, i, _i, _len, _ref;

        if (code === 0) {
          buf = new Buffer(_this.length);
          i = 0;
          _ref = _this.chunks;
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            c = _ref[_i];
            c.copy(buf, i, 0, c.length);
            i += c.length;
          }
          return callback(buf);
        } else {
          return callback(null);
        }
      });
    };

    return _Class;

  })();

}).call(this);
