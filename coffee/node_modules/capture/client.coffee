childProcess = require 'child_process'
path = require 'path'
phantomjs = require 'phantomjs'

module.exports = class
	constructor: (@dna) ->

	run: (callback) ->
		stream = childProcess.spawn phantomjs.path, [path.join __dirname, 'bridge.js']
		stream.stdin.setEncoding = 'utf-8'
		stream.stdin.write JSON.stringify(@dna) + "\n"
		stream.stdout.on 'data', (data) ->
			callback data
